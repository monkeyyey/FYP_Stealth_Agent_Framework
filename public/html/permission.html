<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="/css/filepermission.css" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/801503bc53.js" crossorigin="anonymous"></script>


    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap4.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap4.min.css">

    <!-- For modal -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- For datepicker -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"
        integrity="sha512-T/tUfKSV1bihCnd+MxKD0Hm1uBBroVYBOYSk1knyvQ9VyZJpc/ALb4P0r6ubwVPSGB2GvjeoMAJJImBG12TiaQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.standalone.min.css"
        integrity="sha512-TQQ3J4WkE/rwojNFo6OJdyu6G8Xe9z8rMrlF9y7xpFbQfW5g8aSWcygCQ4vqRiJqFsDsE1T6MoAOMJkFXlrI9A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
        integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body id="body">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark" style="z-index: 3">
        <a class="navbar-brand ml-4" href="/">Stealth Monkey</a>
        <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navbarContent"
        >
        </button>
        <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav md-auto" id="navbarr">
                <li class="nav-item">
                    <a class="nav-link" href="/home">Home</a>
                </li>
                <li class="nav-item pr-2">
                    <a class="nav-link" href="/intrusion_detection">Intrusion</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/security_analytics">Analytics</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/file_permission">Permission</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/file_integrity">Integrity</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/custom">Custom</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/virustotal">File Scan</a>
                </li>
                <li class="nav-item">
                    <a href="/register" class="nav-link">Register</a>
                </li>
                <li class="nav-item">
                    <a href="/agents" class="nav-link">Agents</a>
                </li>
                <li class="nav-item">
                    <a href="/profiles" class="nav-link">Profiles</a>
                </li>
                <li class="bg-danger rounded ml-2">
                    <a onclick="logout()" href="/login" class="nav-link">Logout</a>
                </li>
            </ul>
        </div>
    </nav>
    
    <div class="row justify-content-center m-4">
        <div class="row justify-content-center col-xl-12 w-100 bg-dark mb-4">
            <table class="mt-4 table table-hover table-dark col-md-10 col-sm-12" id = "agent-table">
                <thead class="text-warning">
                <tr>
                    <th scope="col">Agent Name</th>
                    <th scope="col">IP address</th>
                    <th scope="col">Port</th>
                    <th scope="col">Status</th>
                    <th scope="col">Last Status update</th>
                    <th scope="col">Uptime</th>
                </tr>
                </thead>
                <tbody id="agents"></tbody>
            </table>
        </div>
        

        <div class="col-xl-12 w-100 bg-dark row justify-content-center ">
            <h2 class="text-light pt-4 col-xl-12 text-center" id="agent_header">Logs</h2>

            <div class="col-md-12 col-lg-10 col-xl-10 p-3 justify-content-center text-center text-light">
                <div id="analytics_info"></div>
            </div>

            <div class="col-md-12 col-lg-2 col-xl-2 p-3 justify-content-center row mx-auto text-center" id="side_info">
                <div class="col-xl-12 bg-light text-dark card mb-4 p-3">
                    <p>Duration:</p>
                    <button class="btn btn-warning w-100 m-2 mx-auto" onclick="filterChartPeriod(300000)">Past 5
                        Minutes</button>
                    <button class="btn btn-warning w-100 m-2 mx-auto" onclick="filterChartPeriod(1800000)">Past Half
                        Hour</button>
                    <button class="btn btn-warning w-100 m-2 mx-auto" onclick="filterChartPeriod(3600000)">Past
                        Hour</button>
                    <button class="btn btn-warning w-100 m-2 mx-auto" onclick="filterChartPeriod(86400000)">Past
                        Day</button>
                </div>

                <div class="col-xl-12 bg-light text-dark card mb-4 p-3">
                    <label for="nickname">Endpoint:</label>
                    <select name="filternameChart" id="filternameChart">
                        <option value="all">All</option>
                    </select>
                    <button type="submit" onclick="change_agent()" class="btn btn-primary w-100 m-2 mx-auto">Filter
                        Chart</button>

                </div>

                <div class="col-xl-12 bg-light text-dark card mb-4 p-3" id="chart_filter">
                    <p>Filter by Date:</p>
                    <small class="text-dark">Start:</small>
                    <div class="input-group date" data-provide="datepicker">
                        <input type="text" class="form-control" id="startingDate">
                        <div class="input-group-addon">
                            <span class="ml-2 fa-solid fa-calendar-days"></span>
                        </div>
                    </div>
                    <small class="text-dark">End:</small>
                    <div class="input-group date" data-provide="datepicker">
                        <input type="text" class="form-control" id="endingDate">
                        <div class="input-group-addon">
                            <span class="ml-2 fa-solid fa-calendar-days"></span>
                        </div>
                    </div>

                    <button type="submit" onclick="filterChart()" class="btn btn-primary w-100 m-2 mx-auto">Filter
                        Chart</button>
                </div>
                <button onClick="window.location.reload();" class="btn btn-warning w-100 m-2 mx-auto">Reset
                    Chart</button>
            </div>
            <div class="row col-xl-12 my-3 d-flex justify-content-between">
                <div class="col-xl-4 py-3 row">
                    <div class="pb-3 w-100" id="side_crit">
                    </div>
                </div>
                <div class="col-xl-4 py-3 row">
                    <div class="pb-3 w-100" id="side_low">
                    </div>
                </div>
                <div class="col-xl-4 py-3 row">
                    <div class="pb-3 w-100" id="side_agent">
                    </div>
                </div>



            </div>
        </div>

        <!-- config auditd -->
        <div class="col-xl-4 my-4 text-center justify-content-center row">
            <button class="col-xl-12 btn btn-info my-sm-0 mx-auto py-5 mx-auto" data-toggle="modal"
                data-target="#editConfigModal">View audit.d Config</button>
        </div>


        <div class="col-xl-12 w-100 py-4 my-4 bg-dark text-light row mx-auto">
            <h2 class="text-center col-xl-12">Critical Alerts</h2>
            <div class="col-md-12 col-lg-12 col-xl-10 p-3 justify-content-center text-light mx-auto"
                id="critical_table">
                <table
                    class="col-md-12 col-lg-12 col-xl-12 table table-fluid table-striped table-light table-bordered table-sm table-fixed"
                    id="crit_table">
                </table>
            </div>
            <form class="col-xl-2 text-center w-100 px-auto">
                <h2>Filter</h2>
                <div class="bg-light text-dark card mb-4 p-3">
                    <label for="nickname">Endpoint:</label>
                    <select name="filtername2" id="filtername2">
                        <option value="all">All</option>
                    </select>
                </div>
                <div class="bg-light text-dark card mb-4 p-3">
                    <div class="bg-light" id="chart_filter">
                        <p>Date:</p>
                        <small class="text-dark">Start:</small>
                        <div class="input-group date" data-provide="datepicker">
                            <input type="text" class="form-control" id="tableStart">
                            <div class="input-group-addon">
                                <span class="ml-2 fa-solid fa-calendar-days"></span>
                            </div>
                        </div>
                        <small class="text-dark">End:</small>
                        <div class="input-group date" data-provide="datepicker">
                            <input type="text" class="form-control" id="tableEnd">
                            <div class="input-group-addon">
                                <span class="ml-2 fa-solid fa-calendar-days"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-light text-dark card mb-4 p-3">
                    <p>View History:</p>
                    <button id="history" class="btn btn-secondary w-100 mx-auto"
                        onclick="event.preventDefault();viewHistory();">History</button>
                </div>
                <div class="mx-auto px-auto text-center">
                    <button id="filtering" class="btn btn-primary w-100 m-2 mx-auto"
                        onclick="filter('critical_table','crit_table','-','critical','filtername2','-','tableStart','tableEnd')">Filter</button>
                    <button id="filtering" class="btn btn-warning w-100 m-2 mx-auto"
                        onclick="event.preventDefault(); window.location.reload();">Refresh Table</button>
                </div>
            </form>

        </div>

        <div class="col-xl-12 w-100 py-4 bg-dark text-light row mx-auto">

            <h2 class="text-center col-xl-12">All Logs</h2>
            <div class="col-md-12 col-lg-12 col-xl-10 p-3 justify-content-center text-light mx-auto" id="filterarea">
                <table
                    class="col-md-12 col-lg-12 col-xl-12 table table-fluid table-striped table-light table-bordered table-sm table-fixed"
                    id="filteredarea">
                </table>
            </div>

            <form class="col-xl-2 text-center w-100 px-auto">
                <h2>Filter</h2>
                <br>
                <div class="bg-light text-dark card mb-4 p-3">
                    <label for="nickname">Endpoint:</label>
                    <select name="filtername" id="filtername">
                        <option value="all">All</option>
                    </select>
                </div>

                <div class="bg-light text-dark card mb-4 p-3">
                    <label for="risk">Risk:</label>
                    <select name="filterrisk" id="filterrisk">
                        <option value="all">All</option>
                        <option value="low">Low</option>
                        <option value="critical">Critical</option>
                        <option value="resolved">Resolved</option>
                    </select>
                </div>

                <div class="bg-light text-dark card mb-4 p-3">
                    <div class="bg-light" id="chart_filter">
                        <p>Date:</p>
                        <small class="text-dark">Start:</small>
                        <div class="input-group date" data-provide="datepicker">
                            <input type="text" class="form-control" id="tableStart1">
                            <div class="input-group-addon">
                                <span class="ml-2 fa-solid fa-calendar-days"></span>
                            </div>
                        </div>
                        <small class="text-dark">End:</small>
                        <div class="input-group date" data-provide="datepicker">
                            <input type="text" class="form-control" id="tableEnd1">
                            <div class="input-group-addon">
                                <span class="ml-2 fa-solid fa-calendar-days"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mx-auto px-auto text-center">
                    <button id="filtering" class="btn btn-primary w-100 m-2 mx-auto"
                        onclick="filter('filterarea','filteredarea','-','-','filtername','filterrisk','tableStart1','tableEnd1')">Filter</button>
                    <button id="filtering" class="btn btn-warning w-100 m-2 mx-auto"
                        onclick="event.preventDefault(); window.location.reload();">Refresh Table</button>
                </div>
            </form>
        </div>
        <hr>
        <hr>
        <hr> <!-- style="overflow-y: scroll; height: 700px;" -->


    </div>

    <footer class=" text-center text-lg-start pt-4 bg-dark text-secondary" style="background: rgb(0,0,0); background: linear-gradient(180deg, rgba(12,12,12,1) 20%, rgba(16,16,16,1) 70%, rgba(24,24,24,1) 100%)">
        <div class="container p-4 w-100 text-center justify-content-center">
            <div class="row col-xl-12">
                <div class="col-xl-8 col-lg-6 col-md-12 text-left">
                    <h3 class="col-xl-12 text-light">About Us</h3>
                    <div class="col-xl-12">
                        <p>
                            <b>Stelf on the Shelf</b> is a Proof-of-Concept (POC) project, a framework
                            that can be applied to gather runtime system configuration and status for a targeted system
                            in stealth mode. With the framework in place, a system administrator can monitor and gather
                            vital system information for malware and/or intrusion detection at the EndPoint level.
                        </p>
                    </div>
                </div>

                <div class="col-xl-4 col-md-12 text-left">
                    <h3 class="text-light">Social Media</h3>
                    <a href="https://github.com/monkeyyey/stelf_on_the_shelf"><i class="fab fa-instagram"></i>&nbsp Instagram</a> <br>
                    <a href="https://www.sp.edu.sg/"><i class="fa-solid fa-graduation-cap"></i>&nbsp Singapore Polytechnic</a> <br>
                    <a href="https://github.com/monkeyyey/stelf_on_the_shelf"><i class="fab fa-github"></i>&nbsp Find us on Github!</a> <br>
                </div>
            </div>
        </div>
        <div class="text-center pb-3 text-light">
            Â© 2022 Copyright:
            <a class="text-secondary" href="https://stealth.com/home">Stelf on the Shelf</a>
        </div>
    </footer>

    <!-- For config modal -->
    <div class="modal fade" id="editConfigModal" tabindex="-1" role="dialog" aria-labelledby="editConfigFile"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content bg-dark" style="color: gray;">
                <div class="modal-header border-bottom-0">
                    <h4 class="modal-title pt-1 pl-1" id="editConfigFile">Edit Config</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true" style="color: white;">&times;</span>
                    </button>
                </div>

                <form id="editConfig-form">
                    <div class="modal-body">
                        <div class="form-group">
                            <select class="form-select" id="editConfig">
                                <option selected disabled>Select Endpoint Here</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-info" class="close" data-dismiss="modal" aria-label="Close"
                            id="editConfigButton">View Config</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL FOR POP-UP EDIT Config FORM -->
    <div class="modal fade" id="editConfigModal2" tabindex="-1" role="dialog" aria-labelledby="editConfigFile"
        aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
            <div class="modal-content">
                <div id="editConfigDetails">

                </div>
                <div id="editConfigDetails2">

                </div>
                <div id="editConfigDetails3">

                </div>
            </div>
        </div>
    </div>

    <script>
        var interval;

        $("#editConfigButton").click((event) => {
            event.preventDefault()
            var configDetails = $("#editConfig").val();
            configDetails = configDetails.split(',')

            var ip_addr = configDetails[0]
            var nickname = configDetails[1]
            var port = configDetails[2]
            if (ip_addr) {
                localStorage.setItem("editConfigIP", ip_addr)
                auto_getConfig(ip_addr, nickname, port)
                $("#editConfigModal2").modal("show");
                if (document.getElementById("#editConfigDetails".innerHTML) == null) {
                    const nicknameHTML = `
                        <div class="modal-header border-bottom-0 bg-dark">
                            <h4 class="modal-title pt-1 pl-1 text-light" id="editConfigFile">No Connection to endpoint ${nickname}</h4>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true" style="color: white;">&times;</span>
                            </button>
                        </div>
                        `;
                    $("#editConfigDetails").html(nicknameHTML);

                }
            }
        })
        function viewHistory() {
            document.getElementById(`critical_table`).innerHTML = ""
            axios.get(`/api/perm/history`)
                .then((response) => {
                    var html = `
                            <table
                                class="col-md-12 col-lg-12 col-xl-12 table table-fluid table-striped table-light table-bordered table-sm table-fixed"
                                id="resHistory">
                            <thead>
                                <tr class="w-100">
                                    <th class="th-sm">#</th>
                                    <th class="th-sm">Log ID</th>
                                    <th class="th-sm">Risk Status</th>
                                    <th class="th-sm">Resolved By:</th>
                                    <th class="th-sm">Resolved At:</th>
                                </tr>
                            </thead>
                            <tbody>
                            `

                    const myObject = response.data
                    for (var i = 0; i < myObject.length; i++) {
                        var table_index = i + 1
                        var table_logid = myObject[i]['log_id_fk']
                        var table_risk = myObject[i]['risk']
                        var table_username = myObject[i]['username']
                        var table_timestamp = myObject[i]['resolved_at']

                        appendHTML = `
                                <tr>
                                    <td>${table_index}</td>
                                    <td>${table_logid}</td>
                                    <td>${table_risk}</td>
                                    <td>${table_username}</td>
                                    <td>${table_timestamp}</td>
                                </tr>
                                `
                        html = html.concat(appendHTML)
                    }

                    html = html.concat(`</tbody></table>`)
                    document.getElementById(`critical_table`).innerHTML = html
                    $(document).ready(function () {
                        $(`#resHistory`).DataTable();
                    });
                });
        }
        // Function to get the auditd config file
        function auto_getConfig(ip, nickname, port) {

            var requestBody = {
                nickname: nickname,
                agent_ip: ip,
                baseUrl: `https://${ip}:${port}`,
            }
            document.getElementById("editConfigDetails").innerHTML = ""
            document.getElementById("editConfigDetails2").innerHTML = ""

            console.log(requestBody)
            axios.post(`/api/perm/getconfig`, requestBody).then((response) => {
                console.log('hello')
                console.log(response.data + "hdisaoidosa")
                const myObject = response.data
                var customRules = myObject['customRules']
                var agent_ip = myObject['agent_ip']
                var agent_name = myObject['agent_name']

                const nicknameHTML = `
                        <div class="bg-dark" style="color: white;">
                            <div class="modal-header border-bottom-0">
                                <h4 class="modal-title pt-1 pl-1" id="editmoviename" style="color: white;">Audit.d config for: ${agent_name}</h4>
                            </div>
                            <input type="text" id="editingnickname" value="${agent_name}" readonly></input>
                            <input type="text" id="editingip" value="${agent_ip}" readonly></input>
                            <input type="text" id="editingport" value="${port}" readonly></input>
                        </div>
                        `;
                $("#editConfigDetails").html(nicknameHTML);
                const configContentHTML = `
                        <small class="form-text text-muted">Custom Rules below</small>
                        <div class="form-group row px-3" id="editConfig_Details">
                        </div>
                        `;
                $("#editConfigDetails2").html(configContentHTML);
                const saveOrAddHTML = `
                        <button type="submit" onclick="addRule()" class="btn btn-primary">Add another row</button>
                        <button type="submit" onclick="$('.newRules:last').remove()" class="btn btn-danger">Delete a row</button>
                        <button type="submit" onclick="checkinput()" class="btn btn-primary">Save Changes</button>

                        `;
                $("#editConfigDetails3").html(saveOrAddHTML);
                for (n in customRules) {
                    const ruleHTML = `
                    <input type="text" class="form-control newRules" id="newRule" placeholder="Add new rule here" value="${customRules[n]}" required>
                    `
                    $("#editConfig_Details").append(ruleHTML);
                }
            })

        }

        function addRule() {
            const ruleHTML = `
                    <input type="text" class="form-control newRules" id="newRule" placeholder="Add new rule here" required>
                    `
            $("#editConfig_Details").append(ruleHTML);

        }

        function checkinput() {
            var nickname = $("#editingnickname").val();
            var ip = $("#editingip").val();
            var port = $("#editingport").val();
            const getRuleInput = document.getElementsByClassName('newRules');
            const ruleList = [...getRuleInput].map(input => input.value);
            console.log(ruleList)
            $('#editConfigModal2').modal('hide');
            var requestBody = {
                nickname: nickname,
                agent_ip: ip,
                baseUrl: `https://${ip}:${port}`,
                newdata: ruleList
            }
            axios.post(`/api/perm/postconfig`, requestBody)
                .then((response) => {
                    console.log(response.data)
                    console.log('succeed')
                })
        }

        var nickname = ""
        axios.post(`/api/auth/adminaccess`, { token: localStorage.getItem('jwt_token') }).then((response) => {
            if (response.data.access == 0) {
                window.location.href = '/'
            }
        })

        axios.get(`/api/agents/get_agents`).then((response) => {
            const agentObject = response.data;
            var status = ""
            var current_time = Math.floor(Date.now() / 1000)
            for (const x in agentObject) {
                if(agentObject[x]['scope']){
                    if (agentObject[x]['scope'].includes("3")){
                        try{
                            var last_status_update = parseInt(agentObject[x]['last_status_update'].split("|")[1])
                            console.log(current_time - last_status_update)
                            if ((current_time - last_status_update) < 60){
                                status = "Running"
                            }
                            else{
                                status = "Unreachable"
                            }
                        }
                        catch{
                            status = "Unreachable"
                        }
                        var last_status_update_time
                        if(!agentObject[x]['last_status_update']){
                            var last_status_update_time = "No status update available"
                        }
                        else{
                            var last_status_update_time = agentObject[x]['last_status_update'].split("|")[0]
                        }
                        if(!agentObject[x]['uptime'] || status =="Unreachable"){
                            var uptime = "No uptime available"
                        }
                        else{
                            var uptime = agentObject[x]['uptime'].slice(0, -4)
                        }
                        $("#agents").append(`
                            <tr>
                                <td>${agentObject[x]['agent_name']}</td>
                                <td>${agentObject[x]['agent_ip']}</td>
                                <td>${agentObject[x]['port_number']}</td>
                                <td><span class="bi bi-circle-fill ${status}" id="${agentObject[x]['agent_name']}_status">${status}</span></td>
                                <td>${last_status_update_time}</td>
                                <td>${uptime}</td>
                            </tr>
                        `);  
                        // For config Modal
                        const appendHTML = `
                            <option value="${agentObject[x]['agent_ip']},${agentObject[x]['agent_name']},${agentObject[x]['port_number']}">${agentObject[x]['agent_name']}</option>
                        `
                        $("#editConfig").append(appendHTML);
                    }
                }
            }

            // get for names for filtering
            axios.get(`/api/perm/getnames`).then((response) => {
                var filternames = response.data
                for (n in filternames) {
                    const appendHTML = `
                    <option value="${filternames[n]['agent_name']}">${filternames[n]['agent_name']}</option>
                `
                    $("#filtername").append(appendHTML);
                    $("#filtername2").append(appendHTML);
                    $("#filternameChart").append(appendHTML);
                }
            });


            axios.get(`/api/perm/getperms/all`)
                .then((response) => {
                    const myObject = response.data;

                    var relative_array = []
                    var command_array = []
                    var risk_array = []
                    var time_array = []
                    var risk_table = []

                    var html = `
                        <table
                            class="col-md-12 col-lg-12 col-xl-12 table table-fluid table-striped table-light table-bordered table-sm table-fixed"
                            id="crit_table">
                        <thead>
                            <tr class="w-100">
                            <th class="th-sm" style="width:4%">#</th>
                            <th class="th-sm" style="width:9%">Endpoint</th>
                            <th class="th-sm" style="width:8%">IP Address</th>
                            <th class="th-sm" style="width:53%">Permission Log</th>
                            <th class="th-sm" style="width:12%">Timestamp</th>
                            <th class="th-sm" style="width:7%">Risk</th>
                            <th class="th-sm" style="width:7%">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            `

                    for (n in myObject) {
                        time_array.push(myObject[n]['created_at'])
                        command_array.push(myObject[n]['details'])
                        risk_array.push(myObject[n]['risk'])

                        // For alert table
                        if (myObject[n]['risk'] == "--critical--") {
                            risk_table.push(myObject[n])
                        }

                        relative_array.push(n)
                    }
                    for (let i = 0; i < risk_table.length; i++) {
                        var table_index = i + 1
                        var table_nickname = risk_table[i]['agent_name']
                        var table_ipadd = risk_table[i]['ip_address']
                        var table_permlog = risk_table[i]['details']
                        var table_timestamp = risk_table[i]['created_at']
                        var table_risk = risk_table[i]['risk']

                        appendHTML = `
                                    <tr id="${risk_table[i]['log_id']}">
                                    <td>${table_index}</td>
                                    <td>${table_nickname}</td>
                                    <td>${table_ipadd}</td>
                                    <td>${table_permlog}</td>
                                    <td>${table_timestamp}</td>
                                    <td><p class="text-danger">${table_risk}</p></td>
                                    <td id="log${risk_table[i]['log_id']}">
                                        <a id="[8]" onclick="setResolved('${risk_table[i]['log_id']}')" href="#">
                                            Resolve
                                        </a>    
                                    </td>
                                    </tr>`

                        html = html.concat(appendHTML)
                    }
                    html = html.concat(`</tbody>`)


                    document.getElementById("crit_table").innerHTML = html
                    $(document).ready(function () {
                        $('#crit_table').DataTable();
                    });

                    var endtime = getTimes().endtime
                    var today = getTimes().today




                    var risk_trace = {
                        x: time_array,
                        y: risk_array,
                        mode: 'markers'
                    }



                    var layout = {
                        autosize: true,
                        autorange: false,
                        height: 800,
                        margin: {
                            l: 100,
                            r: 50,
                            b: 100,
                            t: 50,
                            pad: 2
                        },
                        xaxis: {
                            type: 'date',
                            range: [endtime, today],
                        }
                    }
                    var data = [risk_trace]
                    Plotly.newPlot('analytics_info', data, layout)

                    update_info()

                    interval = setInterval(function () {
                        axios.get(`/api/perm/getperms/all`)
                            .then((response) => {
                                const myObject = response.data;
                                console.log(time_array[-1])
                                time_array = []
                                command_array = []
                                risk_array = []
                                for (n in myObject) {
                                    time_array.push(myObject[n]['created_at'])
                                    command_array.push(myObject[n]['details'])
                                    risk_array.push(myObject[n]['risk'])
                                }

                                var endtime = getTimes().endtime
                                var today = getTimes().today

                                var minuteView = {
                                    xaxis: {
                                        type: 'date',
                                        range: [endtime, today],
                                    }
                                }

                                var update = {
                                    x: time_array,
                                    y: risk_array
                                }
                                console.log(update)
                                Plotly.relayout('analytics_info', minuteView)
                                Plotly.extendTraces('analytics_info', [update], [0])


                            }).catch((error) => {
                                console.log(error);
                            });

                        update_info()
                    }, 10000);
                })
                .catch((error) => {
                    console.log(error);
                });
            axios.get(`/api/perm/getperm`)
                .then((response) => {
                    var html = `<thead>
                            <tr class="w-100">
                            <th class="th-sm" style="width:4%">#</th>
                            <th class="th-sm" style="width:9%">Endpoint</th>
                            <th class="th-sm" style="width:8%">IP Address</th>
                            <th class="th-sm" style="width:60%">Permission Log</th>
                            <th class="th-sm" style="width:12%">Timestamp</th>
                            <th class="th-sm" style="width:7%">Risk</th>
                            </tr>
                            </thead>
                            <tbody>
                        `
                    const myObject = response.data;
                    for (let i = 0; i < myObject.length; i++) {

                        var table_index = i + 1
                        var table_nickname = myObject[i]['agent_name']
                        var table_ipadd = myObject[i]['ip_address']
                        var table_permlog = myObject[i]['details']
                        var table_timestamp = myObject[i]['created_at']
                        var table_risk = myObject[i]['risk']

                        appendHTML = `<tr>
                                            <td>${table_index}</td>
                                            <td>${table_nickname}</td>
                                            <td>${table_ipadd}</td>
                                            <td>${table_permlog}</td>
                                            <td>${table_timestamp}</td>
                                            <td><p class="text-danger">${table_risk}</p></td>
                                            </tr>`
                        html = html.concat(appendHTML)
                    }
                    html = html.concat(`</tbody>`)
                    document.getElementById("filteredarea").innerHTML = html

                    $(document).ready(function () {
                        $('#filteredarea').DataTable();
                    });
                });
        })
            .catch((error) => {
                console.log(error);
            });


        function update_info() {
            axios.get(`/api/perm/getrisk/${'all'}/${'all'}`)
                .then((response) => {
                    var count = response.data.length

                    document.getElementById("side_crit").innerHTML = ""
                    document.getElementById("side_low").innerHTML = ""
                    document.getElementById("side_agent").innerHTML = ""

                    var log_array = []
                    var crit_array = []
                    var low_array = []

                    var critcount = 0
                    var lowcount = 0
                    const myObject = response.data;

                    for (n in myObject) {
                        log_array.push(myObject[n]['agent_name'])

                        if (myObject[n]['risk'] == "--critical--") {
                            crit_array.push(myObject[n]['agent_name'])
                            critcount++

                        } else {
                            low_array.push(myObject[n]['agent_name'])
                            lowcount++
                        }
                    }

                    uniq_logs = [...new Set(log_array)];
                    uniq_crit = [...new Set(crit_array)];
                    uniq_low = [...new Set(low_array)];

                    const sideCritHtml = `
                                    <div class="card">
                                        <h1 class="col-xl-12"><i class="fa fa-exclamation-triangle" aria-hidden="true" id="critical"></i> Critical Risk Logs</h1>
                                        <h2 class="col-xl-12">${critcount} Critical Risks</h2>
                                        <h2 class="col-xl-12"> found in ${uniq_crit.length} Agents! </h2>
                                    </div>
                                        `;
                    $("#side_crit").append(sideCritHtml);

                    const sideLowHtml = `
                                    <div class="card">
                                        <h1 class="col-xl-12"><i class="fa fa-exclamation-triangle" aria-hidden="true" id="warning"></i> Low Risk Logs</h1>
                                        <h2 class="col-xl-12">${lowcount} Low Risks</h2>
                                        <h2 class="col-xl-12"> found in ${uniq_low.length} Agents! </h2>
                                    </div>
                                        `;
                    $("#side_low").append(sideLowHtml);

                    const allLogHtml = `
                                    <div class="card">
                                        <h1 class="col-xl-12"><i class="fa fa-exclamation-circle" aria-hidden="true" id="notice"></i> All Logs</h1>
                                        <h2 class="col-xl-12">${count} Logs</h2>
                                        <h2 class="col-xl-12">recorded in ${uniq_logs.length} Agents!</h2>
                                    </div>
                                        `;
                    $("#side_agent").append(allLogHtml);

                });
        }


        function liveChart() {
            event.preventDefault();
            startInterval(interval)
        }

        function setResolved(log_id) {
            event.preventDefault();
            currentUser = localStorage.getItem('user')
            jwt_token = localStorage.getItem('jwt_token')
            log_id.toString()
            var requestBody = {
                log_id: log_id,
                timestamp: getTimes().today,
                jwt_token: jwt_token
            }
            axios.put(`/api/perm/resolved/${log_id}`, requestBody)
                .then((response) => {
                    const div = document.getElementById(`log${log_id}`)
                    div.innerHTML = `<p class="text-secondary">Resolved</p>`
                })
        }

        function filterChart() {
            event.preventDefault();

            clearInterval(interval)
            var startDate = $("#startingDate").val();
            var endDate = $("#endingDate").val();

            var newStart = ''
            var newEnd = ''
            axios.get(`/api/perm/getfirst`)
                .then((response) => {
                    if (startDate <= endDate || (startDate != '' && endDate == '')) {
                        if (startDate != '') {
                            startDate = startDate.split("/")
                            newStart = startDate[2] + "-" + startDate[0] + "-" + startDate[1]
                        }
                        if (endDate != '') {
                            endDate = endDate.split("/")
                            newEnd = endDate[2] + "-" + endDate[0] + "-" + endDate[1]
                        }

                        if (newEnd == '') {
                            newEnd = getTimes().today
                        } else {
                            newEnd = `${newEnd} 23:59:59`
                        }

                        if (newStart == '') {
                            newStart = response.data[0]['created_at']
                        } else {
                            newStart = `${newStart} 00:00:00`
                        }

                        var minuteView = {
                            xaxis: {
                                type: 'date',
                                range: [newStart, newEnd],
                            }
                        }
                        Plotly.relayout('analytics_info', minuteView)

                    } else {
                        alert('Invalid date range for chart')
                    }
                })

        }

        function filterTable(tableid) {
            event.preventDefault();

            clearInterval(interval)
            var startDate = $("#startingDate").val();
            var endDate = $("#endingDate").val();
            console.log(startDate)
            console.log(endDate)

            startDate = startDate.split("/")
            endDate = endDate.split("/")

            var newStart = startDate[2] + "-" + startDate[0] + "-" + startDate[1]
            var newEnd = endDate[2] + "-" + endDate[0] + "-" + endDate[1]

            if (newStart < newEnd) {
                var minuteView = {
                    xaxis: {
                        type: 'date',
                        range: [newStart, newEnd],
                    }
                }
                Plotly.relayout('analytics_info', minuteView)
            } else if (newStart == newEnd) {
                var minuteView = {
                    xaxis: {
                        type: 'date',
                        range: [`${newStart} 00:00:00`, `${newEnd} 23:59:59`],
                    }
                }
                Plotly.relayout('analytics_info', minuteView)
            } else {
                alert('Invalid date range for chart')
            }
        }

        function filter(bigdiv, smalldiv, filtername, filterrisk, nameid, riskid, startid, endid) {
            event.preventDefault();
            document.getElementById(`${bigdiv}`).innerHTML = ""
            if (filtername == "-") {
                filtername = document.getElementById(`${nameid}`).value
            }

            if (filterrisk == "-") {
                filterrisk = document.getElementById(`${riskid}`).value
            }
            var newStart = ''
            var newEnd = ''
            var startDate = $(`#${startid}`).val();
            var endDate = $(`#${endid}`).val();
            if (startDate <= endDate || (startDate != '' && endDate == '')) {
                if (startDate != '') {
                    startDate = startDate.split("/")
                    newStart = startDate[2] + "-" + startDate[0] + "-" + startDate[1]
                }
                if (endDate != '') {
                    endDate = endDate.split("/")
                    newEnd = endDate[2] + "-" + endDate[0] + "-" + endDate[1]
                }

                console.log(bigdiv + smalldiv + filtername + filterrisk + newStart + newEnd)
                getFilterContent(bigdiv, smalldiv, filtername, filterrisk, newStart, newEnd)
            } else {
                alert('Invalid date range for table')
                window.location.reload()
            }
        }


        function getFilterContent(bigdiv, smalldiv, filtername, filterrisk, newStart, newEnd) {

            if (newEnd == '') {
                newEnd = getTimes().today
            } else {
                newEnd = `${newEnd} 23:59:59`
            }

            if (newStart == '') {
                newStart = '1970-01-01 00:00:00'
            } else {
                newStart = `${newStart} 00:00:00`
            }

            console.log('start' + newStart)
            console.log('end' + newEnd)

            axios.get(`/api/perm/getrisk/${filtername}/${filterrisk}`)
                .then((response) => {
                    if (bigdiv == 'critical_table') {
                        var html = `
                            <table
                                class="col-md-12 col-lg-12 col-xl-12 table table-fluid table-striped table-light table-bordered table-sm table-fixed"
                                id="${smalldiv}">
                            <thead>
                                <tr class="w-100">
                                    <th class="th-sm" style="width:4%">#</th>
                                    <th class="th-sm" style="width:9%">Endpoint</th>
                                    <th class="th-sm" style="width:8%">IP Address</th>
                                    <th class="th-sm" style="width:53%">Permission Log</th>
                                    <th class="th-sm" style="width:12%">Timestamp</th>
                                    <th class="th-sm" style="width:7%">Risk</th>
                                    <th class="th-sm" style="width:7%">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                            `

                    } else {
                        var html = `
                            <table
                                class="col-md-12 col-lg-12 col-xl-12 table table-fluid table-striped table-light table-bordered table-sm table-fixed"
                                id="${smalldiv}">
                            <thead>
                                <tr class="w-100">
                                    <th class="th-sm" style="width:4%">#</th>
                                    <th class="th-sm" style="width:9%">Endpoint</th>
                                    <th class="th-sm" style="width:8%">IP Address</th>
                                    <th class="th-sm" style="width:60%">Permission Log</th>
                                    <th class="th-sm" style="width:12%">Timestamp</th>
                                    <th class="th-sm" style="width:7%">Risk</th>
                                </tr>
                            </thead>
                            <tbody>
                            `
                    }

                    const myObject = response.data
                    var counter = 0
                    for (var i = 0; i < myObject.length; i++) {
                        if (myObject[i]['created_at'] <= newEnd && myObject[i]['created_at'] >= newStart) {
                            var table_index = counter + 1
                            var table_nickname = myObject[i]['agent_name']
                            var table_ipadd = myObject[i]['ip_address']
                            var table_permlog = myObject[i]['details']
                            var table_timestamp = myObject[i]['created_at']
                            var table_risk = myObject[i]['risk']


                            if (bigdiv == 'critical_table') {
                                appendHTML = `<tr id='${myObject[i]['log_id']}'>
                                    <td>${table_index}</td>
                                    <td>${table_nickname}</td>
                                    <td>${table_ipadd}</td>
                                    <td>${table_permlog}</td>
                                    <td>${table_timestamp}</td>
                                    <td><p class="text-danger">${table_risk}</p></td>
                                    <td id="log${myObject[i]['log_id']}">
                                        <a id="[8]" onclick="setResolved('${myObject[i]['log_id']}')" href="#">
                                            Resolve
                                        </a>    
                                    </td>
                                </tr>`
                            } else {
                                appendHTML = `<tr>
                                <td>${table_index}</td>
                                <td>${table_nickname}</td>
                                <td>${table_ipadd}</td>
                                <td>${table_permlog}</td>
                                <td>${table_timestamp}</td>
                                <td><p class="text-danger">${table_risk}</p></td>
                                </tr>`
                            }
                            html = html.concat(appendHTML)
                        }
                    }

                    html = html.concat(`</tbody></table>`)
                    document.getElementById(`${bigdiv}`).innerHTML = html
                    $(document).ready(function () {
                        $(`#${smalldiv}`).DataTable();
                    });
                });

        }

        function auto_getlogs() {
            var baseUrl = `https://192.168.202.129:5000`
            axios.get(`${baseUrl}/updatepermlogs`).then((response) => {
                if (response) {
                    console.log(response)
                    axios.post(`/api/perm/getpermlogs`, response.data)
                }
            })
        }


        function change_agent() {
            var nickname = $("#filternameChart").val();
            if (nickname == 'all') {
                window.location.reload()
                document.getElementById("agent_header").innerHTML = `<h2>Logs</h2>`

            } else {
                document.getElementById("analytics_info").innerHTML = ""
                document.getElementById("agent_header").innerHTML = `<h2>Logs for '${nickname}'</h2>`

                axios.get(`/api/perm/getperms/${nickname}`)
                    .then((response) => {
                        const myObject = response.data;
                        localStorage.setItem('permlogs', myObject)
                        var relative_array = []
                        var command_array = []
                        var risk_array = []
                        var time_array = []
                        var risk_table = []

                        var html = `
                        <table
                            class="col-md-12 col-lg-12 col-xl-12 table table-fluid table-striped table-light table-bordered table-sm table-fixed"
                            id="crit_table">
                        <thead>
                            <tr class="w-100">
                            <th class="th-sm" style="width:4%">#</th>
                            <th class="th-sm" style="width:9%">Endpoint</th>
                            <th class="th-sm" style="width:8%">IP Address</th>
                            <th class="th-sm" style="width:53%">Permission Log</th>
                            <th class="th-sm" style="width:12%">Timestamp</th>
                            <th class="th-sm" style="width:7%">Risk</th>
                            <th class="th-sm" style="width:7%">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            `

                        for (n in myObject) {
                            time_array.push(myObject[n]['created_at'])
                            command_array.push(myObject[n]['details'])
                            risk_array.push(myObject[n]['risk'])

                            // For alert table
                            if (myObject[n]['risk'] == "--critical--") {
                                risk_table.push(myObject[n])
                            }
                            relative_array.push(n)
                        }
                        for (let i = 0; i < risk_table.length; i++) {
                            var table_index = i + 1
                            var table_nickname = risk_table[i]['agent_name']
                            var table_ipadd = risk_table[i]['ip_address']
                            var table_permlog = risk_table[i]['details']
                            var table_timestamp = risk_table[i]['created_at']
                            var table_risk = risk_table[i]['risk']

                            appendHTML = `
                                    <tr id="${risk_table[i]['log_id']}">
                                    <td>${table_index}</td>
                                    <td>${table_nickname}</td>
                                    <td>${table_ipadd}</td>
                                    <td>${table_permlog}</td>
                                    <td>${table_timestamp}</td>
                                    <td><p class="text-danger">${table_risk}</p></td>
                                    <td id="log${risk_table[i]['log_id']}">
                                        <a id="[8]" onclick="setResolved('${risk_table[i]['log_id']}')" href="#">
                                            Resolve
                                        </a>    
                                    </td>
                                    </tr>`

                            html = html.concat(appendHTML)
                        }
                        html = html.concat(`</tbody></table>`)
                        document.getElementById("critical_table").innerHTML = html
                        $(document).ready(function () {
                            $('#crit_table').DataTable();
                        });

                        var endtime = getTimes().endtime
                        var today = getTimes().today

                        var risk_trace = {
                            x: time_array,
                            y: risk_array,
                            mode: 'markers'
                        }

                        var layout = {
                            autosize: true,
                            autorange: false,
                            height: 800,
                            margin: {
                                l: 100,
                                r: 50,
                                b: 100,
                                t: 50,
                                pad: 2
                            },
                            xaxis: {
                                type: 'date',
                                range: [endtime, today],
                            }
                        }
                        var data = [risk_trace]
                        Plotly.newPlot('analytics_info', data, layout)
                    })
                    .catch((error) => {
                        console.log(error);
                    });
            }
        }

        function check_status(ip, agent_name) {
            var requestBody = {
                agent_ip: ip,
                agent_nickname: agent_name
            }
            axios.post(`/api/agents/check_status`, requestBody).then((response) => {
                var status = response.data.status
                if (status == 'unreachable') {
                    document.getElementById(`${nickname}`).innerHTML = ""
                    $(`#${nickname}`).attr("class", "justify-content-center card bg-danger border border-secondary col-xl-2 col-lg-3 col-md-4 col-sm-6 m-2");
                    document.getElementById(`${nickname}`).innerHTML = `
                        <div class="h-75 content_img">
                            <img class="col-12 h-100 pt-4" src="/img/agent.png">
                        </div>
                        <div class="card-body">
                            <h5 class="card-text text-light">Nickname: ${nickname}</h5>
                            <h5 class="card-text text-light">IP: ${ip}</h5>
                            <button class="btn btn-dark" onclick="change_agent('${ip}}','${nickname}')">View</button>
                            <button class="btn btn-dark" onclick="check_status('${ip}','${nickname}')">Check status</button>
                        </div>
                        `
                }
                if (status == 'running') {
                    document.getElementById(`${nickname}`).innerHTML = ""
                    $(`#${nickname}`).attr("class", "justify-content-center card bg-success border border-secondary col-xl-2 col-lg-3 col-md-4 col-sm-6 m-2");
                    document.getElementById(`${nickname}`).innerHTML = `
                        <div class="h-75 content_img">
                            <img class="col-12 h-100 pt-4" src="/img/agent.png">
                        </div>
                        <div class="card-body">
                            <h5 class="card-text text-light">Nickname: ${nickname}</h5>
                            <h5 class="card-text text-light">IP: ${ip}</h5>
                            <button class="btn btn-dark" onclick="change_agent('${ip}','${nickname}')">View</button>
                            <button class="btn btn-dark" onclick="check_status('${ip}','${nickname}')">Check status</button>
                        </div>
                    `
                }
                if (status == 'reachable') {
                    document.getElementById(`${nickname}`).innerHTML = ""
                    $(`#${nickname}`).attr("class", "justify-content-center card bg-warning border border-secondary col-xl-2 col-lg-3 col-md-4 col-sm-6 m-2");
                    document.getElementById(`${nickname}`).innerHTML = `
                        <div class="h-75 content_img">
                            <img class="col-12 h-100 pt-4" src="/img/agent.png">
                        </div>
                        <div class="card-body">
                            <h5 class="card-text text-light">Nickname: ${nickname}</h5>
                            <h5 class="card-text text-light">IP: ${ip}</h5>
                            <button class="btn btn-dark" onclick="change_agent('${ip}','${nickname}')">View</button>
                            <button class="btn btn-dark" onclick="check_status('${ip}','${nickname}')">Check status</button>
                        </div>
                    `
                }
            })
        }

        // Function to get current time and 5 days back for chart
        function getTimes() {
            // logic for date
            var today = new Date()
            var days = 86400000 //number of milliseconds in a day
            var endtime = new Date(today - (5 * days))
            var endmonth = new String(today.getMonth() + 1)
            var endday = new String(today.getDate())
            var endminutes = new String(today.getMinutes())
            var endseconds = new String(today.getSeconds())
            var endhours = new String(today.getHours())
            var endmonth1 = new String(endtime.getMonth() + 1)
            var endday1 = new String(endtime.getDate())
            endmonth = time_format(endmonth)
            endday = time_format(endday)
            endmonth1 = time_format(endmonth1)
            endday1 = time_format(endday1)
            endminutes = time_format(endminutes)
            endseconds = time_format(endseconds)
            endhours = time_format(endhours)

            var timenow = endhours + ":" + endminutes + ":" + endseconds
            endtime = endtime.getFullYear() + "-" + endmonth1 + "-" + endday1 + " " + timenow
            today = today.getFullYear() + "-" + endmonth + "-" + endday + " " + timenow

            return { today, endtime }
        }

        function filterChartPeriod(times) {
            event.preventDefault();
            clearInterval(interval)
            var times = getTimePeriod(times)
            minuteView = {
                xaxis: {
                    type: 'date',
                    range: [times.starting, times.current],
                }
            }

            Plotly.relayout('analytics_info', minuteView)
        }

        function getTimePeriod(time) {

            var unix_timestamp = Date.now()
            var current_time = new Date(unix_timestamp)
            var start_time = new Date(unix_timestamp - time)
            console.log(current_time)
            var current_month = new String(current_time.getMonth() + 1)
            var current_day = new String(current_time.getDate())
            var current_minutes = new String(current_time.getMinutes())
            var current_seconds = new String(current_time.getSeconds())
            var current_hours = new String(current_time.getHours())

            var start_month = new String(start_time.getMonth() + 1)
            var start_day = new String(start_time.getDate())
            var start_minutes = new String(start_time.getMinutes())
            var start_seconds = new String(start_time.getSeconds())
            var start_hours = new String(start_time.getHours())

            current_month = time_format(current_month)
            current_day = time_format(current_day)
            current_minutes = time_format(current_minutes)
            current_seconds = time_format(current_seconds)
            current_hours = time_format(current_hours)

            start_month = time_format(start_month)
            start_day = time_format(start_day)
            start_minutes = time_format(start_minutes)
            start_seconds = time_format(start_seconds)
            start_hours = time_format(start_hours)

            var current = current_time.getFullYear() + "-" + current_month + "-" + current_day + " " + current_hours + ":" + current_minutes + ":" + current_seconds
            var starting = start_time.getFullYear() + "-" + start_month + "-" + start_day + " " + start_hours + ":" + start_minutes + ":" + start_seconds

            return { current, starting }


        }
        function time_format(time) {
            if (time.length == 1) {
                time = "0" + time
            }
            return time
        }


        // for modal
        $('#exampleModal').on('shown.bs.modal', function () {
            $('#ModalButton').trigger('focus')
        })


        // Logout function
        function logout() {
            localStorage.clear()
        }

    </script>

</body>

<script>
</script>

</html>